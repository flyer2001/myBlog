name: PublishSwift

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout main branch
        uses: actions/checkout@v3
        with:
          ref: main
          
      - name: Fetch latest changes
        run: git fetch origin main
        
      - name: Pull last commit
        run: git pull
      
      - name: Run publish generate command
        run: |
          cd ${{ github.workspace }}
          publish generate
          
      - name: Print path to Output folder
        run: echo "Path to Output folder: ${{ github.workspace }}/Output"
        
      - name: Remove files in /var/www/popyvanov.ru/s
        run: rm -rf /var/www/popyvanov.ru/s/Output/*
        
      - name: Copy files from Output folder to /var/www/popyvanov.ru/s
        run: cp -r ${{ github.workspace }}/Output/* /var/www/popyvanov.ru/s/Output
